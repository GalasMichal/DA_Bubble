<div class="chat-content">

  @if (currentMessage) {


  @if(!hideDetails ){
  <app-time-separator [userDate]="currentMessage" class="full-width"></app-time-separator>
  }
  <div class="user-message-container" [ngClass]="{'user-message-container-right': meUser}">
    
    <!-- REACTION BAR -->
    
    <div class="reaction-bar" [ngClass]="{'reaction-bar-right': meUser}">
    
      <!-- EMOJI -->
      <div class="emoji">
          <emoji-mart #emojiContainer (emojiClick)="addEmoji($event)
           "[ngClass]="{'show-emoji': isEmojiPickerVisibleMessage[index]}"
           [showPreview]="false"
           [enableSearch]="false"
           [showSingleCategory]="false"
           ></emoji-mart>
        </div>
      <!-- EMOJI END-->
  
      <button (click)="showEmojiWindow(index)">
          <svg width="22" height="21" viewBox="0 0 22 21" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9.99048 21C8.60715 21 7.30715 20.7375 6.09048 20.2125C4.87381 19.6875 3.81548 18.975 2.91548 18.075C2.01548 17.175 1.30298 16.1167 0.777979 14.9C0.252979 13.6833 -0.00952148 12.3833 -0.00952148 11C-0.00952148 9.61667 0.252979 8.31667 0.777979 7.1C1.30298 5.88333 2.01548 4.825 2.91548 3.925C3.81548 3.025 4.87381 2.3125 6.09048 1.7875C7.30715 1.2625 8.60715 1 9.99048 1C10.7405 1 11.4696 1.07917 12.178 1.2375C12.8863 1.39583 13.5571 1.625 14.1905 1.925C14.1238 2.09167 14.0738 2.26667 14.0405 2.45C14.0071 2.63333 13.9905 2.81667 13.9905 3C13.9905 3.23333 14.0155 3.45417 14.0655 3.6625C14.1155 3.87083 14.1821 4.06667 14.2655 4.25C13.6488 3.86667 12.9821 3.5625 12.2655 3.3375C11.5488 3.1125 10.7905 3 9.99048 3C7.77381 3 5.88631 3.77917 4.32798 5.3375C2.76965 6.89583 1.99048 8.78333 1.99048 11C1.99048 13.2167 2.76965 15.1042 4.32798 16.6625C5.88631 18.2208 7.77381 19 9.99048 19C12.2071 19 14.0946 18.2208 15.653 16.6625C17.2113 15.1042 17.9905 13.2167 17.9905 11C17.9905 10.3333 17.9113 9.69167 17.753 9.075C17.5946 8.45833 17.3738 7.875 17.0905 7.325C17.3571 7.54167 17.6488 7.70833 17.9655 7.825C18.2821 7.94167 18.6238 8 18.9905 8C19.0738 8 19.1613 7.99583 19.253 7.9875C19.3446 7.97917 19.4321 7.96667 19.5155 7.95C19.6655 8.43333 19.7821 8.92917 19.8655 9.4375C19.9488 9.94583 19.9905 10.4667 19.9905 11C19.9905 12.3833 19.728 13.6833 19.203 14.9C18.678 16.1167 17.9655 17.175 17.0655 18.075C16.1655 18.975 15.1071 19.6875 13.8905 20.2125C12.6738 20.7375 11.3738 21 9.99048 21ZM13.4905 10C13.9238 10 14.2821 9.85833 14.5655 9.575C14.8488 9.29167 14.9905 8.93333 14.9905 8.5C14.9905 8.06667 14.8488 7.70833 14.5655 7.425C14.2821 7.14167 13.9238 7 13.4905 7C13.0571 7 12.6988 7.14167 12.4155 7.425C12.1321 7.70833 11.9905 8.06667 11.9905 8.5C11.9905 8.93333 12.1321 9.29167 12.4155 9.575C12.6988 9.85833 13.0571 10 13.4905 10ZM6.49048 10C6.92381 10 7.28215 9.85833 7.56548 9.575C7.84881 9.29167 7.99048 8.93333 7.99048 8.5C7.99048 8.06667 7.84881 7.70833 7.56548 7.425C7.28215 7.14167 6.92381 7 6.49048 7C6.05715 7 5.69881 7.14167 5.41548 7.425C5.13215 7.70833 4.99048 8.06667 4.99048 8.5C4.99048 8.93333 5.13215 9.29167 5.41548 9.575C5.69881 9.85833 6.05715 10 6.49048 10ZM9.99048 16.5C11.1738 16.5 12.2196 16.175 13.128 15.525C14.0363 14.875 14.6905 14.0333 15.0905 13H4.89048C5.29048 14.0333 5.94465 14.875 6.85298 15.525C7.76131 16.175 8.80715 16.5 9.99048 16.5ZM17.9905 4H16.9905C16.7071 4 16.4696 3.90417 16.278 3.7125C16.0863 3.52083 15.9905 3.28333 15.9905 3C15.9905 2.71667 16.0863 2.47917 16.278 2.2875C16.4696 2.09583 16.7071 2 16.9905 2H17.9905V1C17.9905 0.716667 18.0863 0.479167 18.278 0.2875C18.4696 0.0958333 18.7071 0 18.9905 0C19.2738 0 19.5113 0.0958333 19.703 0.2875C19.8946 0.479167 19.9905 0.716667 19.9905 1V2H20.9905C21.2738 2 21.5113 2.09583 21.703 2.2875C21.8946 2.47917 21.9905 2.71667 21.9905 3C21.9905 3.28333 21.8946 3.52083 21.703 3.7125C21.5113 3.90417 21.2738 4 20.9905 4H19.9905V5C19.9905 5.28333 19.8946 5.52083 19.703 5.7125C19.5113 5.90417 19.2738 6 18.9905 6C18.7071 6 18.4696 5.90417 18.278 5.7125C18.0863 5.52083 17.9905 5.28333 17.9905 5V4Z" fill="black"/>
          </svg>
      </button>
  
      <button (click)="openThread(currentMessage)">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <mask id="mask0_1823_21784" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
              <rect width="24" height="24" fill="#D9D9D9"/>
              </mask>
              <g mask="url(#mask0_1823_21784)">
              <path d="M7 14H17C17.2833 14 17.5207 13.904 17.712 13.712C17.904 13.5207 18 13.2833 18 13C18 12.7167 17.904 12.479 17.712 12.287C17.5207 12.0957 17.2833 12 17 12H7C6.71667 12 6.479 12.0957 6.287 12.287C6.09567 12.479 6 12.7167 6 13C6 13.2833 6.09567 13.5207 6.287 13.712C6.479 13.904 6.71667 14 7 14ZM7 11H17C17.2833 11 17.5207 10.904 17.712 10.712C17.904 10.5207 18 10.2833 18 10C18 9.71667 17.904 9.479 17.712 9.287C17.5207 9.09567 17.2833 9 17 9H7C6.71667 9 6.479 9.09567 6.287 9.287C6.09567 9.479 6 9.71667 6 10C6 10.2833 6.09567 10.5207 6.287 10.712C6.479 10.904 6.71667 11 7 11ZM7 8H17C17.2833 8 17.5207 7.90433 17.712 7.713C17.904 7.521 18 7.28333 18 7C18 6.71667 17.904 6.479 17.712 6.287C17.5207 6.09567 17.2833 6 17 6H7C6.71667 6 6.479 6.09567 6.287 6.287C6.09567 6.479 6 6.71667 6 7C6 7.28333 6.09567 7.521 6.287 7.713C6.479 7.90433 6.71667 8 7 8ZM20.3 20.3L18 18H4C3.45 18 2.97933 17.8043 2.588 17.413C2.196 17.021 2 16.55 2 16V4C2 3.45 2.196 2.979 2.588 2.587C2.97933 2.19567 3.45 2 4 2H20C20.55 2 21.021 2.19567 21.413 2.587C21.8043 2.979 22 3.45 22 4V19.575C22 20.025 21.796 20.3373 21.388 20.512C20.9793 20.6873 20.6167 20.6167 20.3 20.3ZM4 4V16H18.825L20 17.175V4H4Z" fill="black"/>
              </g>
              </svg>
      </button>
      @if(meUser){
  
          <button (click)="showEditCloud()">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <mask id="mask0_1823_21788" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
              <rect width="24" height="24" fill="#D9D9D9"/>
              </mask>
              <g mask="url(#mask0_1823_21788)">
              <path d="M12 20C11.45 20 10.9792 19.8042 10.5875 19.4125C10.1958 19.0208 10 18.55 10 18C10 17.45 10.1958 16.9792 10.5875 16.5875C10.9792 16.1958 11.45 16 12 16C12.55 16 13.0208 16.1958 13.4125 16.5875C13.8042 16.9792 14 17.45 14 18C14 18.55 13.8042 19.0208 13.4125 19.4125C13.0208 19.8042 12.55 20 12 20ZM12 14C11.45 14 10.9792 13.8042 10.5875 13.4125C10.1958 13.0208 10 12.55 10 12C10 11.45 10.1958 10.9792 10.5875 10.5875C10.9792 10.1958 11.45 10 12 10C12.55 10 13.0208 10.1958 13.4125 10.5875C13.8042 10.9792 14 11.45 14 12C14 12.55 13.8042 13.0208 13.4125 13.4125C13.0208 13.8042 12.55 14 12 14ZM12 8C11.45 8 10.9792 7.80417 10.5875 7.4125C10.1958 7.02083 10 6.55 10 6C10 5.45 10.1958 4.97917 10.5875 4.5875C10.9792 4.19583 11.45 4 12 4C12.55 4 13.0208 4.19583 13.4125 4.5875C13.8042 4.97917 14 5.45 14 6C14 6.55 13.8042 7.02083 13.4125 7.4125C13.0208 7.80417 12.55 8 12 8Z" fill="#1C1B1F"/>
              </g>
          </svg>
      </button>
      }
  
      <button class="edit-message" (click)="editThisMessage(currentMessage.text, currentMessage.chatId, currentMessage.messageSendBy.uId)" [ngClass]="{'show-cloud': showCloud}">
          Nachricht bearbeiten
      </button>
      
  </div>
        
    <!-- REACTION BAR ENDE-->
    <img class="avatar"
      (click)="openDialogWithImage(currentMessage.messageSendBy.avatarUrl || './assets/media/icons/profile-icons/profile-icon.svg')"
      src={{currentMessage.messageSendBy.avatarUrl}} alt="profil-image" />

    <div class="message-content" [ngClass]="{'message-content-right': meUser}">
      <div class="message-container">

        <div class="user-time" [ngClass]="{'user-time-right': meUser}">
          <button (click)="openProfileUserSingle(currentMessage.messageSendBy.uId)">
            {{currentMessage.messageSendBy.displayName}}</button>
          <span>{{ (currentMessage.timestamp.seconds * 1000) | date: 'H:mm' }} Uhr</span>
        </div>

        <div class="messages-main-chat" [ngClass]="{'messages-main-chat-right': meUser}">
          @if(currentMessage.storageData) {
          <img class="message-image" (click)="openDialogWithImage(currentMessage.storageData)"
            src={{currentMessage.storageData}} alt="message-image" />
          }
          {{currentMessage.text}}
          @if(currentMessage.editCount > 0) {
          <span class="message-edited">Bearbeitet {{ (currentMessage.lastEdit.seconds * 1000 ) | date: 'H:mm' }}</span>
          }
        </div>
        
        <div class="answer-container"(click)="openThread(currentMessage)">
          <!-- Counter of the answer in Thread -->
          <span class="answer-counter">{{currentMessage.answerCount}} </span>
          <div  class="answer">{{currentMessage.time}} <a
              class="answer">Antworten</a></div>
          @if (!hideDetails) {
          <div class="time-stamp">{{currentMessage.lastAnswer}}</div>
          } @else {
          <div class="line-separator"></div>
          }
        </div>
      </div>

      <div class="emoijReaction">
        @for( emoji of currentMessage.reactions; track emojis[index]) {
        <button (click)="increaseCounter(emoji.symbol)" class="single-emoij">{{emoji.symbol}} {{emoji.count}}
          <app-reaction-cloud [name]="getUsersForEmoji(emoji.symbol)" [symbol]="emoji.symbol"></app-reaction-cloud>
        </button>
        }

      </div>
    </div>

  </div>
  }

</div>